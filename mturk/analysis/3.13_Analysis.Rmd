---
title: "3.13_Analysis"
author: "Emmi Russo"
date: "3/16/2018"
output: html_notebook
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(tidyboot)
library(lme4)
library(dplyr)
```

```{r}
data <- read_csv("../data/3.13_data.csv")

nwords <- function(string, pseudo=F){
  string = gsub("[^[:alpha:][:space:]]", "", string)
  ifelse( pseudo, 
          pattern <- "\\S+", 
          pattern <- "[[:alpha:]]+" 
        )
  str_count(string, pattern)
}

data <- data %>%
  mutate(ul = nwords(utterance))

ac_info <- data %>%
  group_by(subj, trial) %>%
  distinct(.,passed_ac) %>%
  group_by(subj) %>%
  summarise(num_ac_passed = sum(passed_ac), percent_ac_passed = num_ac_passed/n() * 100)

data_with_ac_info <- data %>%
  left_join(ac_info, by="subj")

# Throw out the rude people who didn't pay attention
data <- data_with_ac_info %>%
  filter(percent_ac_passed >= 95)

ggplot(ac_info, aes(x=num_ac_passed, stat="count")) + geom_bar()

# remove crappy utterance :( - shouldn't make a difference bc not test utterance 
data <- data %>%
  filter(speaker != "MOM")


# error pos data
error_pos_info <- read_csv("../error_pos_data.csv")

# add in error positions
data <- data %>%
  left_join(., error_pos_info)

comparison_data <- data %>%
  filter(is_test_utterance & word_response_time < 1000 & word_response_time > 150) %>%
  group_by(subj, trial, version, utterance_in_exchange) %>%
  mutate(centered_pos = 1:n()-error_position)

single_subj_data <- comparison_data %>%
  filter(subj == 1)

ggplot(data, aes(x = word_response_time, fill = speaker)) +
  xlim(0, 1000) +
  geom_histogram()

ggplot(comparison_data, aes(x = centered_pos, y = log(word_response_time), fill = version)) +
  geom_smooth() +
  facet_wrap(~trial)

comparison_data <- comparison_data %>%
  filter(error_position >= 3)

ggplot(comparison_data, aes(x = centered_pos, y = log(word_response_time), fill = version)) +
  geom_smooth() +
  geom_vline(xintercept = 0) +
  xlim(-1, 5) +
  facet_wrap(~trial)


ggplot(comparison_data, aes(y = word_response_time, x = centered_pos, fill = version)) +
  geom_smooth(method="loess") +
  coord_cartesian(xlim = c(-1, 5)) +
  facet_wrap(~trial)

# check data size for u and g versions actually seen
sanity_check <- data %>%
  filter(is_test_utterance) %>%
  group_by(subj) %>%
  summarise(n_g = sum(version == "g"), n_u = sum(version == "u"))

total_stats <- sanity_check %>%
  summarise(total_g = sum(n_g), total_u = sum(n_u))


lmer(log(word_response_time) ~ version + (1|subj), data = comparison_data) %>%
  summary()

```